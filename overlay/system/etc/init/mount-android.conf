# Mount device partitions

description "Mount device partitions"

start on (startup
    and started udev)

emits mounted-android

task

script

    /usr/sbin/mount-android.sh

    # use stock miui audio_policy_configuration.xml
    mount -o bind /opt/halium-overlay/vendor/etc/audio_policy_configuration.xml /vendor/etc/audio_policy_configuration.xml

    # overlay /vendor/bin/vndservicemanager
    mount -o bind /usr/share/halium-overlay/vendor/bin/vndservicemanager /android/vendor/bin/vndservicemanager

    # overlay /vendor/lib64/libqti-perfd-client.so with an older version
    # workarounds PulseAudio/libhybris crash, has to be investigated further
    mount -o bind /usr/share/halium-overlay/vendor/lib64/libqti-perfd-client.so /android/vendor/lib64/libqti-perfd-client.so

    if [ -d /android/metadata ]; then
        mount -o bind /android/metadata /var/lib/lxc/android/rootfs/metadata
    fi
    initctl emit -n mounted-android
end script
